# mle-template-case-sprint2

Здесь укажите имя вашего бакета: s3-student-mle-20240823-82d2b061f8

## Этап 1. Разворачивание MLflow Tracking Server и MLflow Model Registry. Регистрация существующей модели.

В ходе этого этапа был написан файл run_mlflow_server.sh и зарегистрирована в MLflow модель из предыдущего спринта. Модель, её метрики и данные на которых она обучалась, были загружены из директории предыдущего спринта. Код загрузки и регистрации модели находится в файле stage_1.ipynb.

Команда для запуска MLflow-сервера: sh mlflow_server/run_mlflow_server.sh

Название эксперимента в MLflow: sprint_2

Run name: baseline_model

Run id: 4c7344a283b74e19a939bd362742e37e

Название зарегистрированной модели: baseline_model 


## Этап 2. Исследовательский Анализ Данных (EDA).

В ходе этого этапа был проведен исследователский анализ данных.

Основные выводы этого этапа:

1. Нужно удалить столбец studio
2. Нужно удалить единственную квартиру пятого типа.
3. Квартиры расположенные на этажах выше 25 можно считать выбросами.
4. Дома в которых больше 30 этажей можно считать выбросами.
5. В столбце price есть сильные выбросы.
6. Квартира с flat_id = 91136 сильно отличается от остальных по цене, для старых квартир. Нужно удалить эту строку.
7. Стоит разделить этажи на три типа: первый этаж; все этажи кроме первого и последнего; последний этаж. После создания нового столбца нужно удалить столбцы floor и floors_total.
8. Дома в которых только одна квартира стоит вывести в отдельный тип, а столбец flats_count удалить.


Название эксперимента в MLflow: sprint_2

Run name: EDA

Run id: e0e48b685c184f67aa6aca75156c5df4


## Этап 3. Генерация Признаков и Обучение Новой Версии Модели.

На основании выводов, сделанных в прошлом этапе, были сформированы два новых признака: тип этажа и частный дом. 

После этого к числовым признакам были применены PolynomialFeatures, KBinsDiscretizer и StandardScaler, а к категориальным OneHotEncoder. Эти преобразования были сделаны с использованием ColumnTransformer. Из полученных признаков был создан новый DataFrame.

Затем были автоматечиски сгенерированы новые признаки с помощью AutoFeatRegressor. Они также были добавлены в новый DataFrame.

Использовать для всех преобразований один pipeline не получилось, так как при использовании PolynomialFeatures появлялись константные признаки, содержащие одинаковое значение в каждой строке, а AutoFeatRegressor не имеет get_feature_names_out(). Это не позволяло в дальнейшем использовать SequentialFeatureSelector. Поэтому таблицы со сгенерированными признаками были объеденины, и уже из них удалены константные признаки и признаки которые были изначально.

В дальнейшем, после отбора признаков, не составляет проблем объеденить все трансоформации в pipeline, оставив только необходимые.

Модель, обученная на новых признаках, показала лучшие результаты по сравнению с изначальной.

Название эксперимента в MLflow: sprint_2

Run name: model_with_new_features

Run id: b4246b98338a4599902e593ece9bd01e

Название зарегистрированной модели: model_with_new_features


## Этап 4. Отбор Признаков и Обучение Новой Версии Модели.

В ходе этого этапа были отобрана 40 признаков с помощью SFS, затем из этих признаков были отбраны 10 с использованием SBFS. Такой подход пришлось применить, так как по условию проекта необходимо использовать как минимум два метода отбора из библиотеки mlxtend, а методы SBS и SBFS очень долго отбирают признаки, и времени, выделенного на использование виртуальной машины, не достаточно.

Графики и отобранные признаки сохранены в директории FS_ASSETS.

Название эксперимента в MLflow: sprint_2

Run name: model_with_selected_features

Run id: b9d12e224a5e434a9866b548e06014ab

Название зарегистрированной модели: model_with_selected_features


## Этап 5. Подбор гиперпараметров и обучение новой версии модели.

В ходе этого этапа были использованы два метода подбора гиперпараметров из библиотеки optuna: TPESampler, CmaEsSampler. Результаты практичеcки не отличаются, но лучшие получились при использовании TPESampler.

Графики и отобранные гиперпараметры сохранены в директории OPTUNA_ASSETS.

Название эксперимента в MLflow: sprint_2

Run name: model_optuna_TPESampler

Run id: d8792911b4e749b2834d2fc3353daf8d

Название зарегистрированной модели: model_optuna_TPESampler